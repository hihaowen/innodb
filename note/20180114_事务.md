事务
========================

## 概念

> 以前上课的时候老师说,事务就是为了保证数据库完整性而存在的,现在看了这本书,只字未提,汗,这本书上写的是,事务是从保证数据库从一种状态转换为另一种状态的东西.感觉很像原子特性定义

## ACID

ACID是个什么鬼呢,其实我的理解是大家公认的一个行业准则,如果你要开发一个事务型数据库,那么就必须遵循这么几个特性

 - 原子性

> 原子性用我的理解就是说,一个事务可能有很多个操作单元,而原子就是把这么多操作单元打包,作为一个整体,所有的操作都成功执行,事务才算成功,如果其中一个或者多个操作失败,那么这个事务就算失败,其他成功的操作也变成了失败状态,不是很理解,举个例子: 比如a用户转账给b用户转账,转账之前a是100元余额,b是0元,如果转账了20元之后,a余额为80元,b余额为20元,也就是说先给a扣款20元,再给用户b转账20元,这算是完整的一个事务,但是如果给用户a扣款20元后,银行出故障了,用户b没收到20元,那这就不符合原子性

 - 隔离性

> 就是两个事务会话不相互干扰,互不影响,这个跟数据库隔离级别有关系的

 - 一致性

> 拿原子性的例子来说,如果转账操作中途出现故障,用户a的余额还是100元,b用户钱的余额还是0元,这叫做一致性

 - 持久性

> 持久性应该是都具有的,及事务一旦成功执行,数据就一定会被完整保存,哪怕是机房爆炸了,数据也不会丢失

## 事务的种类

 - 扁平事务

> 扁平事务就是我们最初知道的功能,事务中一个操作不成功,那么所有操作都会会滚,回到最初状态

 - 带有保存点的扁平事务

> 带有保存点的事务,其实就是一种特殊的扁平事务,这个功能跟 git reset 很类似

 - 链事务

> (摘抄的)可视为保存点模式的一种变种,带有保存点的扁平事务,当发生系统崩溃时,所有的保存点都将消失,因为其保存点是易失的,而非持久的,这意味着当进行恢复时候,事务需要从开始出重新执行,而不能从最近的一个保存点继续执行

 - 嵌套事务

> `TODO`

 - 分布式事务

> 分布式的物理环境,比较复杂`TODO`

## 事务的实现

事务commit操作后,事务的保证是通过重做日志来保证,重做日志主要包含两个方面:redo log和undo log,redo log主要是为了解决持久化问题,而undo log主要是为了解决多版本控制,撤销操作

 - redo
 
> redo log主要分为两个部分,一个是redo log buffer,一个是redo log file,其他的`TODO`

 - undo
 
> 这里理解不深 `TODO`

 - purge

> `TODO`

## 剩下的 ...

`TODO`
